<Window x:Class="DotGame.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="DotGame - 2D Physics Particle Simulator"
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="300"/>
        </Grid.ColumnDefinitions>

        <!-- Simulation Canvas -->
        <Border Grid.Column="0" BorderBrush="Black" BorderThickness="2" Margin="10" SizeChanged="SimulationBorder_SizeChanged">
            <Grid>
                <Canvas x:Name="SimulationCanvas"
                        Background="WhiteSmoke"
                        MouseLeftButtonDown="SimulationCanvas_MouseLeftButtonDown"
                        MouseRightButtonDown="SimulationCanvas_MouseRightButtonDown"
                        MouseMove="SimulationCanvas_MouseMove"
                        MouseRightButtonUp="SimulationCanvas_MouseRightButtonUp"
                        TouchDown="SimulationCanvas_TouchDown"
                        TouchMove="SimulationCanvas_TouchMove"
                        TouchUp="SimulationCanvas_TouchUp"
                        IsManipulationEnabled="True"/>

                <!-- Particle Details Tooltip -->
                <Border x:Name="ParticleTooltip"
                        Background="#F0F0F0"
                        BorderBrush="Black"
                        BorderThickness="1"
                        CornerRadius="5"
                        Padding="10"
                        Visibility="Collapsed"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top">
                    <StackPanel>
                        <TextBlock x:Name="TooltipText"
                                   FontFamily="Consolas"
                                   FontSize="11"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Control Panel with Tabs -->
        <Border Grid.Column="1" BorderBrush="Gray" BorderThickness="1" Margin="10" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Particle Physics Simulator"
                          FontSize="16"
                          FontWeight="Bold"
                          Margin="0,0,0,10"/>

                <TabControl Grid.Row="1">
                    <!-- CONTROLS TAB -->
                    <TabItem Header="Controls">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Control Buttons -->
                                <GroupBox Header="Simulation" Margin="0,0,0,10">
                                    <StackPanel>
                                        <Button x:Name="StartButton" Content="Start" Click="StartButton_Click" Margin="0,5" Padding="5" Background="LightGreen"/>
                                        <Button x:Name="StopButton" Content="Stop" Click="StopButton_Click" Margin="0,5" Padding="5" Background="LightCoral"/>
                                        <Button x:Name="ResetButton" Content="Reset" Click="ResetButton_Click" Margin="0,5" Padding="5"/>
                                    </StackPanel>
                                </GroupBox>

                                <!-- Presets -->
                                <GroupBox Header="Presets" Margin="0,0,0,10">
                                    <StackPanel>
                                        <TextBlock Text="Load Preset:" Margin="0,0,0,5"/>
                                        <ComboBox x:Name="PresetComboBox" SelectionChanged="PresetComboBox_SelectionChanged" Padding="5"/>
                                    </StackPanel>
                                </GroupBox>

                                <!-- Save/Load -->
                                <GroupBox Header="Settings" Margin="0,0,0,10">
                                    <StackPanel>
                                        <Button x:Name="SaveSettingsButton" Content="Save Settings" Click="SaveSettingsButton_Click" Margin="0,5" Padding="5"/>
                                        <Button x:Name="LoadSettingsButton" Content="Load Settings" Click="LoadSettingsButton_Click" Margin="0,5" Padding="5"/>
                                    </StackPanel>
                                </GroupBox>

                                <!-- Info -->
                                <GroupBox Header="Status">
                                    <TextBlock x:Name="InfoTextBlock" Text="Click Start to begin" TextWrapping="Wrap"/>
                                </GroupBox>

                                <!-- Performance -->
                                <GroupBox Header="Performance" Margin="0,10,0,0">
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="FPS: " FontWeight="Bold"/>
                                            <TextBlock x:Name="FpsTextBlock" Text="0.0" FontSize="14"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="Particles: " FontWeight="Bold"/>
                                            <TextBlock x:Name="ParticleCountTextBlock" Text="0" FontSize="14"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- BASIC TAB -->
                    <TabItem Header="Basic">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Particle Count -->
                                <TextBlock Text="Particle Count:" FontWeight="Bold" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="ParticleCountSlider" Minimum="1" Maximum="500" Value="50" TickFrequency="10" IsSnapToTickEnabled="True" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="ParticleCountTextBox" Grid.Column="1" Text="50" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Max Particles -->
                                <TextBlock Text="Max Particles:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="MaxParticlesSlider" Minimum="100" Maximum="5000" Value="1000" TickFrequency="100" IsSnapToTickEnabled="True" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="MaxParticlesTextBox" Grid.Column="1" Text="1000" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Random Seed -->
                                <TextBlock Text="Random Seed:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <TextBox x:Name="SeedTextBox" Text="" Height="25" LostFocus="SeedTextBox_LostFocus"/>

                                <!-- Simulation Size (read-only info) -->
                                <TextBlock Text="Simulation Size:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <TextBlock Text="(Auto-sized to canvas)" FontStyle="Italic" FontSize="10" Margin="0,0,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="W:" Margin="0,0,5,0" VerticalAlignment="Center"/>
                                    <TextBox x:Name="SimWidthTextBox" Grid.Column="1" Text="800" IsReadOnly="True" Background="LightGray" VerticalContentAlignment="Center"/>
                                    <TextBlock Grid.Column="2" Text="H:" Margin="10,0,5,0" VerticalAlignment="Center"/>
                                    <TextBox x:Name="SimHeightTextBox" Grid.Column="3" Text="600" IsReadOnly="True" Background="LightGray" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Controls Info -->
                                <GroupBox Header="Controls" Margin="0,15,0,0">
                                    <StackPanel>
                                        <TextBlock Text="Mouse:" FontWeight="Bold" Margin="0,2,0,2"/>
                                        <TextBlock Text="• Left Click: Add particle" Margin="10,2,0,2"/>
                                        <TextBlock Text="• Right Click+Drag: Push particle" Margin="10,2,0,2"/>
                                        <TextBlock Text="• Hover: View particle details" Margin="10,2,0,5"/>

                                        <TextBlock Text="Touch:" FontWeight="Bold" Margin="0,5,0,2"/>
                                        <TextBlock Text="• Tap empty space: Add particle" Margin="10,2,0,2"/>
                                        <TextBlock Text="• Touch+Drag particle: Push particle" Margin="10,2,0,2"/>
                                        <TextBlock Text="• Touch particle: View details" Margin="10,2,0,2"/>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- PHYSICS TAB -->
                    <TabItem Header="Physics">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Gravity -->
                                <TextBlock Text="Gravitational Constant:" FontWeight="Bold" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="GravitySlider" Minimum="0" Maximum="500" Value="100" TickFrequency="10" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="GravityTextBox" Grid.Column="1" Text="100.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Damping -->
                                <TextBlock Text="Damping Factor:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="DampingSlider" Minimum="0.9" Maximum="1.0" Value="0.995" TickFrequency="0.001" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="DampingTextBox" Grid.Column="1" Text="0.995" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Restitution -->
                                <TextBlock Text="Restitution (Bounciness):" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="RestitutionSlider" Minimum="0" Maximum="1" Value="0.8" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="RestitutionTextBox" Grid.Column="1" Text="0.8" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <Separator Margin="0,15"/>

                                <!-- Mass Range -->
                                <TextBlock Text="Mass Range:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Min:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <Slider x:Name="MinMassSlider" Grid.Row="0" Grid.Column="1" Minimum="0.1" Maximum="20" Value="1" TickFrequency="0.1" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="MinMassTextBox" Grid.Row="0" Grid.Column="2" Text="1.0" Margin="5,0,0,5" VerticalContentAlignment="Center"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Max:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <Slider x:Name="MaxMassSlider" Grid.Row="1" Grid.Column="1" Minimum="1" Maximum="50" Value="10" TickFrequency="1" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="MaxMassTextBox" Grid.Row="1" Grid.Column="2" Text="10.0" Margin="5,5,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Radius Range -->
                                <TextBlock Text="Radius Range:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Min:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <Slider x:Name="MinRadiusSlider" Grid.Row="0" Grid.Column="1" Minimum="2" Maximum="30" Value="5" TickFrequency="1" IsSnapToTickEnabled="True" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="MinRadiusTextBox" Grid.Row="0" Grid.Column="2" Text="5.0" Margin="5,0,0,5" VerticalContentAlignment="Center"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Max:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <Slider x:Name="MaxRadiusSlider" Grid.Row="1" Grid.Column="1" Minimum="5" Maximum="50" Value="20" TickFrequency="1" IsSnapToTickEnabled="True" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="MaxRadiusTextBox" Grid.Row="1" Grid.Column="2" Text="20.0" Margin="5,5,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Max Velocity -->
                                <TextBlock Text="Max Initial Velocity:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="MaxVelocitySlider" Minimum="0" Maximum="200" Value="50" TickFrequency="10" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="MaxVelocityTextBox" Grid.Column="1" Text="50.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <Separator Margin="0,15"/>

                                <!-- Physics Toggles -->
                                <TextBlock Text="Enable/Disable:" FontWeight="Bold" Margin="0,10,0,5"/>
                                <CheckBox x:Name="UseGravityCheckBox" Content="Gravity" IsChecked="True" Margin="0,3"/>
                                <CheckBox x:Name="UseCollisionsCheckBox" Content="Collisions" IsChecked="True" Margin="0,3"/>
                                <CheckBox x:Name="UseBoundariesCheckBox" Content="Boundaries" IsChecked="True" Margin="0,3"/>
                                <CheckBox x:Name="UseDampingCheckBox" Content="Damping" IsChecked="True" Margin="0,3"/>
                                <CheckBox x:Name="UseSpatialPartitioningCheckBox" Content="Spatial Partitioning" IsChecked="True" Margin="0,3"/>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- ABILITIES TAB -->
                    <TabItem Header="Abilities">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Enable Abilities -->
                                <CheckBox x:Name="UseAbilitiesCheckBox" Content="Enable Ability System" IsChecked="True" FontWeight="Bold" FontSize="14" Margin="0,5,0,15"/>

                                <!-- Ability Toggles -->
                                <TextBlock Text="Available Abilities:" FontWeight="Bold" Margin="0,5,0,5"/>
                                <CheckBox x:Name="UseEatingCheckBox" Content="Eating" IsChecked="True" Margin="10,3,0,3"/>
                                <CheckBox x:Name="UseSplittingCheckBox" Content="Splitting" IsChecked="True" Margin="10,3,0,3"/>
                                <CheckBox x:Name="UseReproductionCheckBox" Content="Reproduction" IsChecked="True" Margin="10,3,0,3"/>
                                <CheckBox x:Name="UsePhasingCheckBox" Content="Phasing" IsChecked="True" Margin="10,3,0,3"/>
                                <CheckBox x:Name="UseChaseCheckBox" Content="Chase" IsChecked="True" Margin="10,3,0,3"/>
                                <CheckBox x:Name="UseFleeCheckBox" Content="Flee" IsChecked="True" Margin="10,3,0,3"/>

                                <Separator Margin="0,15"/>

                                <!-- Ability Probabilities -->
                                <TextBlock Text="Ability Assignment Probabilities:" FontWeight="Bold" Margin="0,10,0,5"/>
                                <TextBlock Text="(Chance each particle gets each ability)" FontStyle="Italic" FontSize="10" Margin="0,0,0,5"/>

                                <!-- Eating Probability -->
                                <TextBlock Text="Eating:" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="EatingProbSlider" Minimum="0" Maximum="1" Value="0.7" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="EatingProbTextBox" Grid.Column="1" Text="0.7" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Splitting Probability -->
                                <TextBlock Text="Splitting:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="SplittingProbSlider" Minimum="0" Maximum="1" Value="0.3" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="SplittingProbTextBox" Grid.Column="1" Text="0.3" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Reproduction Probability -->
                                <TextBlock Text="Reproduction:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="ReproductionProbSlider" Minimum="0" Maximum="1" Value="0.4" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="ReproductionProbTextBox" Grid.Column="1" Text="0.4" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Phasing Probability -->
                                <TextBlock Text="Phasing:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="PhasingProbSlider" Minimum="0" Maximum="1" Value="0.2" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="PhasingProbTextBox" Grid.Column="1" Text="0.2" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Chase Probability -->
                                <TextBlock Text="Chase:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="ChaseProbSlider" Minimum="0" Maximum="1" Value="0.6" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="ChaseProbTextBox" Grid.Column="1" Text="0.6" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Flee Probability -->
                                <TextBlock Text="Flee:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="FleeProbSlider" Minimum="0" Maximum="1" Value="0.5" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="FleeProbTextBox" Grid.Column="1" Text="0.5" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- ENERGY TAB -->
                    <TabItem Header="Energy">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Base Energy -->
                                <TextBlock Text="Base Energy Capacity:" FontWeight="Bold" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="BaseEnergySlider" Minimum="10" Maximum="500" Value="100" TickFrequency="10" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="BaseEnergyTextBox" Grid.Column="1" Text="100.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Passive Drain -->
                                <TextBlock Text="Passive Energy Drain (per second):" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="PassiveDrainSlider" Minimum="0" Maximum="5" Value="0.5" TickFrequency="0.1" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="PassiveDrainTextBox" Grid.Column="1" Text="0.5" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Eating Gain -->
                                <TextBlock Text="Eating Energy Gain (%):" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="EatingGainSlider" Minimum="0" Maximum="1" Value="0.8" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="EatingGainTextBox" Grid.Column="1" Text="0.8" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Size Ratio for Eating -->
                                <TextBlock Text="Size Ratio for Eating:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <TextBlock Text="(Must be this many times larger to eat)" FontStyle="Italic" FontSize="10" Margin="0,0,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="SizeRatioSlider" Minimum="1" Maximum="3" Value="1.5" TickFrequency="0.1" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="SizeRatioTextBox" Grid.Column="1" Text="1.5" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Vision Range -->
                                <TextBlock Text="Vision Range Multiplier:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="VisionRangeSlider" Minimum="1" Maximum="20" Value="5" TickFrequency="0.5" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="VisionRangeTextBox" Grid.Column="1" Text="5.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Hunger Threshold -->
                                <TextBlock Text="Hunger Threshold:" FontWeight="Bold" Margin="0,10,0,2"/>
                                <TextBlock Text="(Start hunting below this energy %)" FontStyle="Italic" FontSize="10" Margin="0,0,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="HungerThresholdSlider" Minimum="0" Maximum="1" Value="0.3" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="HungerThresholdTextBox" Grid.Column="1" Text="0.3" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <Separator Margin="0,15"/>

                                <!-- Chase/Flee Parameters -->
                                <TextBlock Text="Chase/Flee Settings:" FontWeight="Bold" FontSize="14" Margin="0,10,0,10"/>

                                <!-- Chase Force -->
                                <TextBlock Text="Chase Force:" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="ChaseForceSlider" Minimum="0" Maximum="500" Value="200" TickFrequency="10" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="ChaseForceTextBox" Grid.Column="1" Text="200.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Flee Force -->
                                <TextBlock Text="Flee Force:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="FleeForceSlider" Minimum="0" Maximum="500" Value="250" TickFrequency="10" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="FleeForceTextBox" Grid.Column="1" Text="250.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Chase Energy Cost -->
                                <TextBlock Text="Chase Energy Cost (per second):" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="ChaseEnergyCostSlider" Minimum="0" Maximum="2" Value="0.1" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="ChaseEnergyCostTextBox" Grid.Column="1" Text="0.1" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Flee Energy Cost -->
                                <TextBlock Text="Flee Energy Cost (per second):" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="FleeEnergyCostSlider" Minimum="0" Maximum="2" Value="0.15" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="FleeEnergyCostTextBox" Grid.Column="1" Text="0.15" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- ADVANCED TAB -->
                    <TabItem Header="Advanced">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Type Distribution -->
                                <TextBlock Text="Particle Type Distribution:" FontWeight="Bold" FontSize="14" Margin="0,5,0,10"/>
                                <TextBlock Text="(Auto-normalized to 100%)" FontStyle="Italic" FontSize="10" Margin="0,0,0,5"/>

                                <!-- Predator -->
                                <TextBlock Text="Predator:" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="PredatorProbSlider" Minimum="0" Maximum="1" Value="0.3" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="PredatorProbTextBox" Grid.Column="1" Text="0.3" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Herbivore -->
                                <TextBlock Text="Herbivore:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="HerbivoreProbSlider" Minimum="0" Maximum="1" Value="0.3" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="HerbivoreProbTextBox" Grid.Column="1" Text="0.3" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Social -->
                                <TextBlock Text="Social:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="SocialProbSlider" Minimum="0" Maximum="1" Value="0.2" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="SocialProbTextBox" Grid.Column="1" Text="0.2" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Solitary -->
                                <TextBlock Text="Solitary:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="SolitaryProbSlider" Minimum="0" Maximum="1" Value="0.1" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="SolitaryProbTextBox" Grid.Column="1" Text="0.1" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Neutral -->
                                <TextBlock Text="Neutral:" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="NeutralProbSlider" Minimum="0" Maximum="1" Value="0.1" TickFrequency="0.05" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="NeutralProbTextBox" Grid.Column="1" Text="0.1" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <Separator Margin="0,20"/>

                                <!-- Ability Parameters -->
                                <TextBlock Text="Ability Cooldowns &amp; Costs:" FontWeight="Bold" FontSize="14" Margin="0,10,0,10"/>

                                <!-- Splitting -->
                                <TextBlock Text="Splitting Cooldown (seconds):" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="SplittingCooldownSlider" Minimum="1" Maximum="30" Value="5" TickFrequency="1" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="SplittingCooldownTextBox" Grid.Column="1" Text="5.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Reproduction -->
                                <TextBlock Text="Reproduction Cooldown (seconds):" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="ReproductionCooldownSlider" Minimum="1" Maximum="30" Value="8" TickFrequency="1" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="ReproductionCooldownTextBox" Grid.Column="1" Text="8.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Phasing -->
                                <TextBlock Text="Phasing Cooldown (seconds):" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="PhasingCooldownSlider" Minimum="1" Maximum="30" Value="10" TickFrequency="1" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="PhasingCooldownTextBox" Grid.Column="1" Text="10.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <TextBlock Text="Phasing Duration (seconds):" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="PhasingDurationSlider" Minimum="0.5" Maximum="10" Value="2" TickFrequency="0.5" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="PhasingDurationTextBox" Grid.Column="1" Text="2.0" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <!-- Legacy Cost Fields (kept for compatibility) -->
                                <TextBlock Text="Note: Energy costs now scale with particle mass" FontStyle="Italic" FontSize="10" Margin="0,20,0,5" TextWrapping="Wrap"/>
                                <Grid Visibility="Collapsed">
                                    <Grid.RowDefinitions>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                        <RowDefinition/>
                                    </Grid.RowDefinitions>
                                    <TextBox x:Name="SplittingEnergyCostTextBox" Grid.Row="0" Text="50.0"/>
                                    <TextBox x:Name="ReproductionEnergyCostTextBox" Grid.Row="1" Text="40.0"/>
                                    <TextBox x:Name="PhasingEnergyCostTextBox" Grid.Row="2" Text="30.0"/>
                                    <TextBox x:Name="SplittingSeparationTextBox" Grid.Row="3" Text="100.0"/>
                                    <TextBox x:Name="ReproductionMassTransferTextBox" Grid.Row="4" Text="0.3"/>
                                    <TextBox x:Name="ReproductionEnergyTransferTextBox" Grid.Row="5" Text="0.5"/>
                                </Grid>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- VISUAL TAB -->
                    <TabItem Header="Visual">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <TextBlock Text="Visual Enhancements:" FontWeight="Bold" FontSize="14" Margin="0,5,0,10"/>
                                <TextBlock Text="Toggle visual feedback features" FontStyle="Italic" FontSize="10" Margin="0,0,0,10" TextWrapping="Wrap"/>

                                <!-- Grid Overlay -->
                                <CheckBox x:Name="ShowGridCheckBox" Content="Show Grid Overlay" IsChecked="False" Margin="0,5" Checked="VisualToggle_Changed" Unchecked="VisualToggle_Changed"/>
                                <TextBlock Text="Display a grid to help gauge distances" FontSize="10" Foreground="Gray" Margin="20,0,0,10" TextWrapping="Wrap"/>

                                <!-- Vision Cones -->
                                <CheckBox x:Name="ShowVisionConesCheckBox" Content="Show Vision Cones on Hover" IsChecked="False" Margin="0,5" Checked="VisualToggle_Changed" Unchecked="VisualToggle_Changed"/>
                                <TextBlock Text="Display particle vision range when hovering" FontSize="10" Foreground="Gray" Margin="20,0,0,10" TextWrapping="Wrap"/>

                                <!-- Trail Effects -->
                                <CheckBox x:Name="ShowTrailsCheckBox" Content="Show Particle Trails" IsChecked="False" Margin="0,5" Checked="VisualToggle_Changed" Unchecked="VisualToggle_Changed"/>
                                <TextBlock Text="Display motion trails behind particles" FontSize="10" Foreground="Gray" Margin="20,0,0,10" TextWrapping="Wrap"/>

                                <!-- Energy Bars -->
                                <CheckBox x:Name="ShowEnergyBarsCheckBox" Content="Show Energy Bars" IsChecked="True" Margin="0,5" Checked="VisualToggle_Changed" Unchecked="VisualToggle_Changed"/>
                                <TextBlock Text="Display energy bars above particles" FontSize="10" Foreground="Gray" Margin="20,0,0,10" TextWrapping="Wrap"/>

                                <Separator Margin="0,15"/>

                                <!-- Color Scheme Options -->
                                <TextBlock Text="Color Scheme:" FontWeight="Bold" FontSize="14" Margin="0,10,0,10"/>

                                <RadioButton x:Name="ColorByTypeRadio" Content="Color by Type + Abilities" IsChecked="True" Margin="0,5" GroupName="ColorScheme" Checked="ColorScheme_Changed"/>
                                <TextBlock Text="Uses type-based colors with ability tints" FontSize="10" Foreground="Gray" Margin="20,0,0,5" TextWrapping="Wrap"/>

                                <RadioButton x:Name="ColorByMassRadio" Content="Color by Mass" IsChecked="False" Margin="0,8" GroupName="ColorScheme" Checked="ColorScheme_Changed"/>
                                <TextBlock Text="Red = heavy, Blue = light" FontSize="10" Foreground="Gray" Margin="20,0,0,10" TextWrapping="Wrap"/>

                                <Separator Margin="0,15"/>

                                <!-- Trail Settings -->
                                <TextBlock Text="Trail Settings:" FontWeight="Bold" FontSize="14" Margin="0,10,0,10"/>

                                <TextBlock Text="Trail Length:" Margin="0,5,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="TrailLengthSlider" Minimum="5" Maximum="50" Value="15" TickFrequency="5" IsSnapToTickEnabled="True" ValueChanged="Slider_ValueChanged"/>
                                    <TextBox x:Name="TrailLengthTextBox" Grid.Column="1" Text="15" Margin="5,0,0,0" VerticalContentAlignment="Center"/>
                                </Grid>

                                <Separator Margin="0,15"/>

                                <!-- Info -->
                                <GroupBox Header="Info" Margin="0,10,0,0">
                                    <StackPanel>
                                        <TextBlock Text="Type Colors:" FontWeight="Bold" Margin="0,5,0,5"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <Ellipse Width="12" Height="12" Fill="#C83232" Stroke="Black" StrokeThickness="1" Margin="0,0,5,0"/>
                                            <TextBlock Text="Predator (Red)" FontSize="10"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <Ellipse Width="12" Height="12" Fill="#64C864" Stroke="Black" StrokeThickness="1" Margin="0,0,5,0"/>
                                            <TextBlock Text="Herbivore (Green)" FontSize="10"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <Ellipse Width="12" Height="12" Fill="#6496E6" Stroke="Black" StrokeThickness="1" Margin="0,0,5,0"/>
                                            <TextBlock Text="Social (Blue)" FontSize="10"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <Ellipse Width="12" Height="12" Fill="#B464C8" Stroke="Black" StrokeThickness="1" Margin="0,0,5,0"/>
                                            <TextBlock Text="Solitary (Purple)" FontSize="10"/>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <Ellipse Width="12" Height="12" Fill="#B4B4B4" Stroke="Black" StrokeThickness="1" Margin="0,0,5,0"/>
                                            <TextBlock Text="Neutral (Gray)" FontSize="10"/>
                                        </StackPanel>
                                        <TextBlock Text="Dimness indicates low energy" FontSize="10" FontStyle="Italic" Margin="0,10,0,0"/>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Grid>
        </Border>
    </Grid>
</Window>
